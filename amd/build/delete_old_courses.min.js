define(["jquery","core/ajax","core/modal_factory","core/modal_events","local_deleteoldcourses/loadingicon","core/str"],(function(e,t,o,a,n,d){var c='[data-action="cancel"]',s=null,l=null,r=d.get_strings([{key:"modal_delete_title",component:"local_deleteoldcourses"},{key:"modal_delete_danger_body",component:"local_deleteoldcourses"},{key:"modal_delete_accept",component:"local_deleteoldcourses"},{key:"modal_delete_save_button",component:"local_deleteoldcourses"},{key:"modal_delete_cancel_button",component:"local_deleteoldcourses"},{key:"modal_delete_no_teacher",component:"local_deleteoldcourses"},{key:"modal_delete_close_button",component:"local_deleteoldcourses"}]),i=function(o,d){s.show(),s.setBody(""),s.header.addClass("hidden"),s.footer.addClass("hidden"),n.addIconToContainer(s.body).then((function(n){o.then((function(o){if(o.id){s.setTitle(l[0]+" <strong>"+o.shortname+"</strong>");var n="";if(o.teachers.length>0)n+=function(t,o){var a="<div class='alert alert-warning p-1'>";a+="<i class='fa fa-exclamation-triangle' aria-hidden='true'></i> ",a+=t+"<br>";var n="<ul class='pl-5'>";return e.each(o,(function(e,t){n+="<li><a href='"+t.url+"' target='_blank'>"+t.fullname+"</a></li>"})),a+=n+="</ul>",a+"</div>"}(l[1],o.teachers);s.header.removeClass("hidden"),s.footer.removeClass("hidden"),s.setSaveButtonText(l[3]);var r=s.getFooter().find(c);s.asyncSet(l[4],r.text.bind(r)),n+="<strong>"+l[2]+"</strong>",s.setBody(n),s.getRoot().on(a.save,(function(){s.destroy(),function(o,a){e(a).attr("disabled",!0);var n={methodname:"local_deleteoldcourses_add_course",args:{courseid:o.id,shortname:o.shortname,fullname:o.fullname,coursecreatedat:o.coursecreatedat}},d=t.call([n])[0];e("button[course-id='"+o.id+"']").html("<i class='icon fa fa-circle-o-notch fa-spin'></i>"),d.then((function(t){t.success?(e("button[course-id='"+o.id+"']").removeClass("btn-primary"),e("button[course-id='"+o.id+"']").removeClass("add-course"),e("button[course-id='"+o.id+"']").addClass("btn-danger"),e("button[course-id='"+o.id+"']").addClass("remove-course"),e("button[course-id='"+o.id+"']").html("<i class='fa fa-check' aria-hidden='true'></i>"),e(a).unbind(),e(a).click((function(){h(this)}))):e("button[course-id='"+o.id+"']").html("<i class='fa fa-trash' aria-hidden='true'></i>"),e(a).attr("disabled",!1)}))}(o,d)}))}else s.setTitle(l[5]),s.setBody("<button type='button' class='btn btn-secondary' data-action='cancel'>"+l[6]+"</button>"),s.header.removeClass("hidden")})).catch}))},u=function(n){e("div.modal.moodle-has-zindex").remove(),o.create({type:o.types.SAVE_CANCEL,title:"",body:"",large:!0}).then((function(o){(s=o).getRoot().on(a.cancel,(function(){s.destroy()})),s.getRoot().on(a.hidden,(function(){s.destroy()}));var d=function(e){var o={methodname:"local_deleteoldcourses_get_course",args:{courseid:e}};return t.call([o])[0]}(e(n).attr("course-id"));i(d,n)}))},h=function(o){var a=e(o);a.attr("disabled",!0);var n=a.attr("course-id"),d={methodname:"local_deleteoldcourses_remove_course",args:{courseid:n}},c=t.call([d])[0];e("button[course-id='"+n+"']").html("<i class='icon fa fa-circle-o-notch fa-spin'></i>"),c.then((function(t){t.success?(e("button[course-id='"+n+"']").removeClass("btn-danger"),e("button[course-id='"+n+"']").removeClass("remove-course"),e("button[course-id='"+n+"']").addClass("btn-primary"),e("button[course-id='"+n+"']").addClass("add-course"),e("button[course-id='"+n+"']").html("<i class='fa fa-trash' aria-hidden='true'></i>"),a.unbind(),a.click((function(){u(this)}))):e("button[course-id='"+n+"']").html("<i class='fa fa-check' aria-hidden='true'></i>"),a.attr("disabled",!1)}))};return{init:function(){r.then((function(t){l=t,e("button.add-course").click((function(){u(this)})),e("button.remove-course").click((function(){h(this)}))}))}}}));