define(["jquery","core/ajax","core/modal_factory","core/modal_events","core/loadingicon","core/str"],function(e,t,o,n,a,s){var c='[data-action="cancel"]',d=null,r=o.create({type:o.types.SAVE_CANCEL,title:"",body:"",large:!0}),l=function(t,o){d.show(),d.setBody(""),d.header.addClass("hidden"),d.footer.addClass("hidden"),a.addIconToContainer(d.body).then(function(a){t.then(function(t){s.get_strings([{key:"modal_delete_title",component:"local_deleteoldcourses"},{key:"modal_delete_danger_body",component:"local_deleteoldcourses"},{key:"modal_delete_accept",component:"local_deleteoldcourses"},{key:"modal_delete_save_button",component:"local_deleteoldcourses"},{key:"modal_delete_cancel_button",component:"local_deleteoldcourses"},{key:"modal_delete_no_teacher",component:"local_deleteoldcourses"},{key:"modal_delete_close_button",component:"local_deleteoldcourses"}]).then(function(a){if(t.id){d.setTitle(a[0]+" <strong>"+t.shortname+"</strong>");var s="";if(t.teachers.length>0)s+=function(t,o){var n="<div class='alert alert-warning p-1'>";n+="<i class='fa fa-exclamation-triangle' aria-hidden='true'></i> ",n+=t+"<br>";var a="<ul class='pl-5'>";return e.each(o,function(e,t){a+="<li><a href='"+t.url+"' target='_blank'>"+t.fullname+"</a></li>"}),n+=a+="</ul>",n+="</div>"}(a[1],t.teachers);d.header.removeClass("hidden"),d.footer.removeClass("hidden"),d.setSaveButtonText(a[3]);var r=d.getFooter().find(c);d.asyncSet(a[4],r.text.bind(r)),s+="<strong>"+a[2]+"</strong>",d.setBody(s),d.getRoot().on(n.save,function(){e(this).unbind(),u(t,o)})}else d.setTitle(a[5]),d.setBody("<button type='button' class='btn btn-secondary' data-action='cancel'>"+a[6]+"</button>"),d.header.removeClass("hidden")})}).catch})},i=function(){e("button.add-course").click(function(){var o=function(e){var o={methodname:"local_deleteoldcourses_get_course",args:{courseid:e}};return t.call([o])[0]}(e(this).attr("course-id"));l(o,this)})},u=function(o,n){var a={methodname:"local_deleteoldcourses_add_course",args:{courseid:o.id,shortname:o.shortname,fullname:o.fullname}},s=t.call([a])[0];e("button[course-id='"+o.id+"']").html("<i class='icon fa fa-circle-o-notch fa-spin'></i>"),s.then(function(t){t.success?(e("button[course-id='"+o.id+"']").removeClass("btn-primary"),e("button[course-id='"+o.id+"']").removeClass("add-course"),e("button[course-id='"+o.id+"']").addClass("btn-danger"),e("button[course-id='"+o.id+"']").addClass("remove-course"),e("button[course-id='"+o.id+"']").html("<i class='fa fa-check' aria-hidden='true'></i>"),e(n).unbind(),h()):e("button[course-id='"+o.id+"']").html("<i class='fa fa-trash' aria-hidden='true'></i>")})},h=function(){e("button.remove-course").click(function(){var o=e(this).attr("course-id"),n={methodname:"local_deleteoldcourses_remove_course",args:{courseid:o}},a=t.call([n])[0];e("button[course-id='"+o+"']").html("<i class='icon fa fa-circle-o-notch fa-spin'></i>"),a.then(function(t){t.success?(e("button[course-id='"+o+"']").removeClass("btn-danger"),e("button[course-id='"+o+"']").removeClass("remove-course"),e("button[course-id='"+o+"']").addClass("btn-primary"),e("button[course-id='"+o+"']").addClass("add-course"),e("button[course-id='"+o+"']").html("<i class='fa fa-trash' aria-hidden='true'></i>"),e(this).unbind(),i()):e("button[course-id='"+o+"']").html("<i class='fa fa-check' aria-hidden='true'></i>")})})};return{init:function(){r.then(function(e){d=e,i(),h()})}}});